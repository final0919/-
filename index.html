<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•è¯å››é€‰ä¸€</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800&display=swap" rel="stylesheet">
    <style>
        /* æ ·å¼ä¿æŒä¸å˜ */
        :root {
            --primary-gradient: linear-gradient(45deg, #FFD700, #FFA500);
            --secondary-color: #FFF8DC;
            --text-color: #333333;
            --correct-color: #4CAF50;
            --wrong-color: #F44336;
            --button-hover: scale(1.05);
            --transition-speed: 0.3s;
            --title-color: #FFA500; /* æ–°å¢ï¼šæ•´ä½“æ ‡é¢˜é¢œè‰²å˜é‡ */
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: var(--primary-gradient);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: var(--text-color);
            overflow-x: hidden;
        }
        
        .container {
            width: 100%;
            max-width: 900px;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            position: relative;
            transition: all 0.5s ease;
            min-height: 500px;
            display: flex;
        }
        
        .page {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            min-height: 500px;
            animation: fadeIn 0.5s ease;
            width: 100%;
        }
        
        .page.active {
            display: flex;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        h1 {
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-size: 4rem;
            margin-bottom: 40px;
            text-align: center;
            transition: all var(--transition-speed);
            font-family: 'Montserrat', sans-serif;
            font-weight: 800;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .title-letter {
            display: inline-block;
            transition: color 0.3s;
            color: var(--title-color); /* åº”ç”¨æ•´ä½“æ ‡é¢˜é¢œè‰² */
        }
        
        .btn {
            background: var(--primary-gradient);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all var(--transition-speed);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(255, 165, 0, 0.2);
        }
        
        .btn:hover {
            transform: var(--button-hover);
            box-shadow: 0 6px 15px rgba(255, 165, 0, 0.3);
        }
        
        .btn-icon {
            margin-right: 8px;
        }
        
        .start-btn {
            padding: 20px 50px;
            font-size: 1.5rem;
            margin-top: 20px;
            animation: pulse 2s infinite alternate;
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .start-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }
        
        .start-btn:hover::before {
            left: 100%;
        }
        
        @keyframes pulse {
            from { transform: scale(1); box-shadow: 0 4px 10px rgba(255, 165, 0, 0.2); }
            to { transform: scale(1.05); box-shadow: 0 6px 15px rgba(255, 165, 0, 0.3); }
        }
        
        .settings-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: transparent;
            color: var(--text-color);
            box-shadow: none;
            padding: 10px;
            z-index: 10;
        }
        
        .settings-panel {
            position: absolute;
            top: 0;
            left: 0;
            width: 350px;
            height: 100%;
            background-color: white;
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.1);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            padding: 30px;
            z-index: 100;
            overflow-y: auto;
        }
        
        .settings-panel.active {
            transform: translateX(0);
        }
        
        .settings-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.3);
            z-index: 99;
            display: none;
        }
        
        .settings-overlay.active {
            display: block;
        }
        
        .settings-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close-settings {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
        }
        
        .setting-group {
            margin-bottom: 25px;
        }
        
        .setting-group h3 {
            margin-bottom: 15px;
            color: #555;
        }
        
        .color-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .color-option {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            width: 100%;
        }
        
        .color-option input {
            margin-left: auto;
            width: 40px;
            height: 40px;
            border: none;
            cursor: pointer;
        }
        
        .title-colors {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }
        
        .title-color-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            width: 48%;
        }
        
        .title-color-item span {
            font-size: 0.9rem;
            margin-right: 5px;
        }
        
        .radio-group {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        
        .radio-item {
            display: flex;
            align-items: center;
        }
        
        .radio-item input {
            margin-right: 5px;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 30px;
        }
        
        .countdown {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--text-color);
            transition: color 0.3s;
        }
        
        .countdown.warning {
            color: var(--wrong-color);
            animation: pulse 1s infinite alternate;
        }
        
        .score {
            font-size: 1.2rem;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .question-card {
            background-color: var(--secondary-color);
            border-radius: 15px;
            padding: 30px;
            width: 100%;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .question {
            font-size: 1.5rem;
            margin-bottom: 25px;
            text-align: center;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .option {
            background-color: white;
            border: 2px solid #eee;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.1rem;
        }
        
        /* åˆ é™¤æ‚¬åœç‰¹æ•ˆï¼Œåªä¿ç•™ç‚¹å‡»æ•ˆæœ */
        .option.correct {
            animation: correctEffect 0.5s forwards;
        }
        
        .option.wrong {
            animation: wrongEffect 0.5s forwards;
        }
        
        @keyframes correctEffect {
            0% { background-color: white; transform: scale(1); }
            50% { background-color: var(--correct-color); color: white; transform: scale(1.05); }
            100% { background-color: white; transform: scale(1); }
        }
        
        @keyframes wrongEffect {
            0% { background-color: white; transform: translateX(0); }
            25% { background-color: var(--wrong-color); color: white; transform: translateX(-5px); }
            50% { background-color: var(--wrong-color); color: white; transform: translateX(5px); }
            75% { background-color: var(--wrong-color); color: white; transform: translateX(-5px); }
            100% { background-color: white; transform: translateX(0); }
        }
        
        .correct-answer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--correct-color);
            color: white;
            padding: 20px 40px;
            border-radius: 10px;
            font-size: 1.5rem;
            display: none;
            z-index: 10;
        }
        
        .correct-answer.active {
            display: block;
            animation: fadeInOut 2s forwards;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        .game-over-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .game-over-popup.active {
            opacity: 1;
            visibility: visible;
        }
        
        .popup-content {
            background-color: white;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transform: scale(0.8);
            transition: transform 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .game-over-popup.active .popup-content {
            transform: scale(1);
        }
        
        .final-score {
            font-size: 3rem;
            margin: 20px 0;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: bold;
        }
        
        .score-message {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #666;
        }
        
        .popup-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .popup-buttons .btn {
            flex: 1;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
        }
        
        .encouragement {
            font-size: 3rem;
            animation: bounce 1s infinite alternate;
            margin-bottom: 15px;
        }
        
        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-20px); }
        }
        
        .loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            display: none;
        }
        
        .loading.active {
            display: flex;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #FFA500;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .file-input {
            display: none;
        }
        
        .import-label {
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            width: 100%;
            justify-content: center;
        }
        
        .home-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            width: 100%;
            padding: 20px;
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .settings-panel {
                width: 100%;
            }
            
            h1 {
                font-size: 2.5rem;
            }
            
            .options {
                grid-template-columns: 1fr;
            }
            
            .title-color-item {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="settings-overlay" id="settings-overlay"></div>
    
    <div class="container">
        <!-- é¦–é¡µ -->
        <div id="home-page" class="page active">
            <button id="settings-btn" class="btn settings-btn">
                <span class="btn-icon">âš™ï¸</span> è®¾ç½®
            </button>
            
            <div class="home-content">
                <h1 id="game-title">
                    <span class="title-letter" data-index="0">å•</span>
                    <span class="title-letter" data-index="1">è¯</span>
                    <span class="title-letter" data-index="2">å››</span>
                    <span class="title-letter" data-index="3">é€‰</span>
                    <span class="title-letter" data-index="4">ä¸€</span>
                </h1>
                
                <button id="start-game" class="btn start-btn">
                    å¼€å§‹æ¸¸æˆ
                </button>
            </div>
        </div>
        
        <!-- æ¸¸æˆé¡µé¢ -->
        <div id="game-page" class="page">
            <div class="game-header">
                <button id="back-to-home" class="btn">
                    <span class="btn-icon">ğŸ </span> è¿”å›é¦–é¡µ
                </button>
                <div>
                    <div class="countdown" id="game-countdown">30</div>
                    <div class="score" id="game-score">å¾—åˆ†: 0</div>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question" id="question-text">è¿™é‡Œæ˜¾ç¤ºé—®é¢˜</div>
                <div class="options" id="options-container">
                    <div class="option" data-index="0"></div>
                    <div class="option" data-index="1"></div>
                    <div class="option" data-index="2"></div>
                    <div class="option" data-index="3"></div>
                </div>
            </div>
            
            <div class="correct-answer" id="correct-answer-display"></div>
            
            <div class="loading" id="game-loading">
                <div class="spinner"></div>
            </div>
        </div>
        
        <!-- è®¾ç½®é¢æ¿ -->
        <div class="settings-panel" id="settings-panel">
            <div class="settings-title">
                <h2>æ¸¸æˆè®¾ç½®</h2>
                <button class="close-settings" id="close-settings">Ã—</button>
            </div>
            
            <div class="setting-group">
                <h3>è¯æ±‡è¡¨ç®¡ç†</h3>
                <label for="import-vocab" class="btn import-label">
                    <span class="btn-icon">ğŸ“‚</span> å¯¼å…¥è¯æ±‡è¡¨
                </label>
                <input type="file" id="import-vocab" class="file-input" accept=".csv">
                
                <button id="export-template" class="btn" style="width: 100%; margin-top: 10px;">
                    <span class="btn-icon">ğŸ“¤</span> å¯¼å‡ºæ¨¡æ¿
                </button>
                
                <p id="vocab-count" style="text-align: center; margin-top: 10px; color: #666;">æœªå¯¼å…¥è¯æ±‡è¡¨</p>
            </div>
            
            <div class="setting-group">
                <h3>æ¸¸æˆåç§°</h3>
                <input type="text" id="game-name-input" class="form-control" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ddd;" placeholder="è¾“å…¥æ¸¸æˆåç§°">
            </div>
            
            <div class="setting-group">
                <h3>ç­”æ¡ˆæç¤ºæ—¶é—´è®¾ç½®</h3>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="hint-time-1" name="hint-time" value="1">
                        <label for="hint-time-1">1ç§’</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="hint-time-2" name="hint-time" value="2" checked>
                        <label for="hint-time-2">2ç§’</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="hint-time-3" name="hint-time" value="3">
                        <label for="hint-time-3">3ç§’</label>
                    </div>
                </div>
            </div>
            
            <div class="setting-group">
                <h3>éŸ³æ•ˆè®¾ç½®</h3>
                <label for="correct-sound" class="btn" style="width: 100%;">
                    <span class="btn-icon">âœ…</span> ä¸Šä¼ æ­£ç¡®éŸ³æ•ˆ
                </label>
                <input type="file" id="correct-sound" class="file-input" accept=".mp3,.wav">
                
                <label for="wrong-sound" class="btn" style="width: 100%; margin-top: 10px;">
                    <span class="btn-icon">âŒ</span> ä¸Šä¼ é”™è¯¯éŸ³æ•ˆ
                </label>
                <input type="file" id="wrong-sound" class="file-input" accept=".mp3,.wav">
                
                <label for="end-sound" class="btn" style="width: 100%; margin-top: 10px;">
                    <span class="btn-icon">ğŸ†</span> ä¸Šä¼ ç»“æŸéŸ³æ•ˆ
                </label>
                <input type="file" id="end-sound" class="file-input" accept=".mp3,.wav">
            </div>
            
            <div class="setting-group">
                <h3>å€’è®¡æ—¶è®¾ç½®</h3>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="time-30" name="countdown-time" value="30" checked>
                        <label for="time-30">30ç§’</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="time-45" name="countdown-time" value="45">
                        <label for="time-45">45ç§’</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="time-60" name="countdown-time" value="60">
                        <label for="time-60">60ç§’</label>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ¸¸æˆç»“æŸå¼¹çª— -->
        <div class="game-over-popup" id="game-over-popup">
            <div class="popup-content">
                <h2>æ¸¸æˆç»“æŸ!</h2>
                <p class="score-message" id="score-message"></p>
                <div class="final-score" id="final-score">0</div>
                <div class="popup-buttons">
                    <button id="restart-game" class="btn">é‡æ–°å¼€å§‹</button>
                    <button id="back-home-from-popup" class="btn">è¿”å›é¦–é¡µ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€å˜é‡
        const gameState = {
            vocabList: [],
            currentQuestion: null,
            score: 0,
            countdown: 30,
            hintTime: 2, // æ–°å¢ï¼šç­”æ¡ˆæç¤ºæ—¶é—´ï¼Œé»˜è®¤ä¸º2ç§’
            timer: null,
            gameName: "å•è¯å››é€‰ä¸€",
            sounds: {
                correct: null,
                wrong: null,
                end: null
            },
            isPlaying: false,
            usedWordIndices: [] // æ–°å¢ï¼šè®°å½•å·²ä½¿ç”¨çš„å•è¯ç´¢å¼•
        };
        
        // DOMå…ƒç´ 
        const elements = {
            // é¡µé¢å…ƒç´ 
            homePage: document.getElementById('home-page'),
            gamePage: document.getElementById('game-page'),
            settingsOverlay: document.getElementById('settings-overlay'),
            
            // é¦–é¡µå…ƒç´ 
            gameTitle: document.getElementById('game-title'),
            titleLetters: document.querySelectorAll('.title-letter'),
            importVocab: document.getElementById('import-vocab'),
            exportTemplate: document.getElementById('export-template'),
            settingsBtn: document.getElementById('settings-btn'),
            startGame: document.getElementById('start-game'),
            vocabCount: document.getElementById('vocab-count'),
            
            // è®¾ç½®é¢æ¿
            settingsPanel: document.getElementById('settings-panel'),
            closeSettings: document.getElementById('close-settings'),
            gameNameInput: document.getElementById('game-name-input'),
            hintTimeRadios: document.querySelectorAll('input[name="hint-time"]'), // æ–°å¢ï¼šç­”æ¡ˆæç¤ºæ—¶é—´é€‰é¡¹
            correctSound: document.getElementById('correct-sound'),
            wrongSound: document.getElementById('wrong-sound'),
            endSound: document.getElementById('end-sound'),
            countdownRadios: document.querySelectorAll('input[name="countdown-time"]'),
            
            // æ¸¸æˆé¡µé¢å…ƒç´ 
            backToHome: document.getElementById('back-to-home'),
            gameCountdown: document.getElementById('game-countdown'),
            gameScore: document.getElementById('game-score'),
            questionText: document.getElementById('question-text'),
            optionsContainer: document.getElementById('options-container'),
            options: document.querySelectorAll('.option'),
            correctAnswerDisplay: document.getElementById('correct-answer-display'),
            gameLoading: document.getElementById('game-loading'),
            
            // æ¸¸æˆç»“æŸå¼¹çª—
            gameOverPopup: document.getElementById('game-over-popup'),
            scoreMessage: document.getElementById('score-message'),
            finalScore: document.getElementById('final-score'),
            restartGame: document.getElementById('restart-game'),
            backHomeFromPopup: document.getElementById('back-home-from-popup')
        };
        
        // åˆå§‹åŒ–
        function init() {
            setupEventListeners();
            updateGameTitle();
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // é¦–é¡µäº‹ä»¶
            elements.importVocab.addEventListener('change', handleVocabImport);
            elements.exportTemplate.addEventListener('click', handleTemplateExport);
            elements.settingsBtn.addEventListener('click', openSettings);
            elements.startGame.addEventListener('click', startGame);
            
            // è®¾ç½®é¢æ¿äº‹ä»¶
            elements.closeSettings.addEventListener('click', closeSettings);
            elements.settingsOverlay.addEventListener('click', closeSettings);
            
            // å®æ—¶åº”ç”¨è®¾ç½®äº‹ä»¶
            elements.gameNameInput.addEventListener('input', applyGameName);
            
            // ç­”æ¡ˆæç¤ºæ—¶é—´è®¾ç½®
            elements.hintTimeRadios.forEach(radio => {
                radio.addEventListener('change', applyHintTime);
            });
            
            // å€’è®¡æ—¶è®¾ç½®
            elements.countdownRadios.forEach(radio => {
                radio.addEventListener('change', applyCountdownTime);
            });
            
            // æ¸¸æˆé¡µé¢äº‹ä»¶
            elements.backToHome.addEventListener('click', returnToHome);
            
            // é€‰é¡¹ç‚¹å‡»äº‹ä»¶
            elements.options.forEach(option => {
                option.addEventListener('click', handleOptionSelect);
            });
            
            // æ¸¸æˆç»“æŸå¼¹çª—äº‹ä»¶
            elements.restartGame.addEventListener('click', restartGame);
            elements.backHomeFromPopup.addEventListener('click', returnToHome);
            
            // éŸ³æ•ˆä¸Šä¼ äº‹ä»¶
            elements.correctSound.addEventListener('change', (e) => loadSound(e, 'correct'));
            elements.wrongSound.addEventListener('change', (e) => loadSound(e, 'wrong'));
            elements.endSound.addEventListener('change', (e) => loadSound(e, 'end'));
        }
        
        // æ‰“å¼€è®¾ç½®é¢æ¿
        function openSettings() {
            elements.settingsPanel.classList.add('active');
            elements.settingsOverlay.classList.add('active');
        }
        
        // å…³é—­è®¾ç½®é¢æ¿
        function closeSettings() {
            elements.settingsPanel.classList.remove('active');
            elements.settingsOverlay.classList.remove('active');
        }
        
        // å®æ—¶åº”ç”¨æ¸¸æˆåç§°
        function applyGameName() {
            const newGameName = elements.gameNameInput.value.trim();
            if (newGameName) {
                gameState.gameName = newGameName;
                updateGameTitle();
            }
        }
        
        // å®æ—¶åº”ç”¨ç­”æ¡ˆæç¤ºæ—¶é—´
        function applyHintTime() {
            for (const radio of elements.hintTimeRadios) {
                if (radio.checked) {
                    gameState.hintTime = parseInt(radio.value);
                    break;
                }
            }
        }
        
        // å®æ—¶åº”ç”¨å€’è®¡æ—¶æ—¶é—´
        function applyCountdownTime() {
            for (const radio of elements.countdownRadios) {
                if (radio.checked) {
                    gameState.countdown = parseInt(radio.value);
                    // æ›´æ–°å€’è®¡æ—¶æ˜¾ç¤º
                    elements.gameCountdown.textContent = gameState.countdown;
                    break;
                }
            }
        }
        
        // å¤„ç†è¯æ±‡è¡¨å¯¼å…¥
        function handleVocabImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    const lines = content.split('\n').filter(line => line.trim() !== '');
                    
                    // éªŒè¯CSVæ ¼å¼
                    if (lines[0].trim() !== 'è‹±æ–‡,ä¸­æ–‡') {
                        alert('è¯æ±‡è¡¨æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ä½¿ç”¨æ­£ç¡®çš„æ¨¡æ¿ã€‚ç¬¬ä¸€è¡Œåº”ä¸º"è‹±æ–‡,ä¸­æ–‡"');
                        return;
                    }
                    
                    // è§£æè¯æ±‡
                    const vocabList = [];
                    for (let i = 1; i < lines.length; i++) {
                        const line = lines[i].trim();
                        if (!line) continue;
                        
                        const [english, chinese] = line.split(',').map(item => item.trim());
                        if (english && chinese) {
                            vocabList.push({ english, chinese });
                        }
                    }
                    
                    if (vocabList.length < 4) {
                        alert('è¯æ±‡è¡¨è‡³å°‘éœ€è¦åŒ…å«4ä¸ªå•è¯æ‰èƒ½å¼€å§‹æ¸¸æˆ');
                        return;
                    }
                    
                    gameState.vocabList = vocabList;
                    elements.vocabCount.textContent = `å·²å¯¼å…¥ ${vocabList.length} ä¸ªå•è¯`;
                    elements.startGame.disabled = false;
                    
                    // é‡ç½®æ–‡ä»¶è¾“å…¥ï¼Œå…è®¸é‡å¤å¯¼å…¥åŒä¸€æ–‡ä»¶
                    elements.importVocab.value = '';
                } catch (error) {
                    alert('å¯¼å…¥å¤±è´¥: ' + error.message);
                }
            };
            reader.readAsText(file);
        }
        
        // å¤„ç†æ¨¡æ¿å¯¼å‡º
        function handleTemplateExport() {
            const templateContent = "è‹±æ–‡,ä¸­æ–‡\napple,è‹¹æœ\nbook,ä¹¦\ncomputer,ç”µè„‘\nstudent,å­¦ç”Ÿ";
            const blob = new Blob([templateContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'è¯æ±‡è¡¨æ¨¡æ¿.csv';
            document.body.appendChild(a);
            a.click();
            
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 0);
        }
        
        // æ›´æ–°æ¸¸æˆæ ‡é¢˜
        function updateGameTitle() {
            elements.gameTitle.textContent = gameState.gameName;
            elements.gameNameInput.value = gameState.gameName;
            document.title = gameState.gameName;
        }
        
        // åŠ è½½éŸ³æ•ˆ
        function loadSound(event, type) {
            const file = event.target.files[0];
            if (!file) return;
            
            const audioUrl = URL.createObjectURL(file);
            gameState.sounds[type] = new Audio(audioUrl);
            
            // å…è®¸é‡å¤æ’­æ”¾åŒä¸€éŸ³æ•ˆ
            gameState.sounds[type].addEventListener('ended', function() {
                this.currentTime = 0;
            });
            
            // é‡ç½®æ–‡ä»¶è¾“å…¥
            event.target.value = '';
            
            alert(`${type === 'correct' ? 'æ­£ç¡®' : type === 'wrong' ? 'é”™è¯¯' : 'ç»“æŸ'}éŸ³æ•ˆä¸Šä¼ æˆåŠŸ`);
        }
        
        // æ’­æ”¾éŸ³æ•ˆ
        function playSound(type) {
            if (gameState.sounds[type]) {
                try {
                    gameState.sounds[type].play();
                } catch (e) {
                    console.log('éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e);
                }
            }
        }
        
        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            if (gameState.vocabList.length < 4) {
                alert('è¯·å…ˆå¯¼å…¥è‡³å°‘åŒ…å«4ä¸ªå•è¯çš„è¯æ±‡è¡¨');
                return;
            }
            
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState.score = 0;
            gameState.isPlaying = true;
            gameState.usedWordIndices = []; // é‡ç½®å·²ä½¿ç”¨å•è¯è®°å½•
            
            // æ›´æ–°UI
            elements.gameScore.textContent = `å¾—åˆ†: ${gameState.score}`;
            elements.gameCountdown.textContent = gameState.countdown;
            elements.gameCountdown.classList.remove('warning');
            
            // åˆ‡æ¢åˆ°æ¸¸æˆé¡µé¢
            elements.homePage.classList.remove('active');
            elements.gamePage.classList.add('active');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            elements.gameLoading.classList.add('active');
            
            // é‡ç½®é€‰é¡¹çŠ¶æ€ï¼ˆç¡®ä¿å¯ä»¥ç‚¹å‡»ï¼‰
            elements.options.forEach(option => {
                option.style.pointerEvents = 'auto';
            });
            
            // ç”Ÿæˆç¬¬ä¸€é¢˜
            setTimeout(() => {
                generateQuestion();
                elements.gameLoading.classList.remove('active');
                startCountdown();
            }, 1000);
        }
        
        // ç”Ÿæˆé—®é¢˜ï¼ˆä¼˜åŒ–ï¼šä¼˜å…ˆä½¿ç”¨æœªå‡ºç°çš„å•è¯ï¼‰
        function generateQuestion() {
            if (gameState.vocabList.length < 4) return;
            
            // è·å–æœªä½¿ç”¨çš„å•è¯ç´¢å¼•
            const availableIndices = [];
            for (let i = 0; i < gameState.vocabList.length; i++) {
                if (!gameState.usedWordIndices.includes(i)) {
                    availableIndices.push(i);
                }
            }
            
            let questionIndex;
            
            // ä¼˜å…ˆä»æœªä½¿ç”¨çš„å•è¯ä¸­é€‰æ‹©
            if (availableIndices.length > 0) {
                questionIndex = availableIndices[Math.floor(Math.random() * availableIndices.length)];
            } else {
                // å¦‚æœæ‰€æœ‰å•è¯éƒ½å·²ä½¿ç”¨è¿‡ï¼Œé‡ç½®è®°å½•å¹¶éšæœºé€‰æ‹©
                gameState.usedWordIndices = [];
                questionIndex = Math.floor(Math.random() * gameState.vocabList.length);
            }
            
            // è®°å½•å·²ä½¿ç”¨çš„å•è¯ç´¢å¼•
            gameState.usedWordIndices.push(questionIndex);
            const questionWord = gameState.vocabList[questionIndex];
            
            // éšæœºå†³å®šé¢˜å‹ï¼šä¸­æ–‡çŒœè‹±æ–‡ (true) æˆ–è‹±æ–‡çŒœä¸­æ–‡ (false)
            const isChineseToEnglish = Math.random() > 0.5;
            
            // æ„å»ºé—®é¢˜å’Œç­”æ¡ˆ
            const questionText = isChineseToEnglish ? questionWord.chinese : questionWord.english;
            const correctAnswer = isChineseToEnglish ? questionWord.english : questionWord.chinese;
            
            // æ”¶é›†æ‰€æœ‰å¯èƒ½çš„å¹²æ‰°é¡¹
            const allPossibleAnswers = gameState.vocabList
                .filter((_, index) => index !== questionIndex)
                .map(word => isChineseToEnglish ? word.english : word.chinese);
            
            // éšæœºé€‰æ‹©3ä¸ªå¹²æ‰°é¡¹
            const distractors = [];
            while (distractors.length < 3) {
                const randomIndex = Math.floor(Math.random() * allPossibleAnswers.length);
                const distractor = allPossibleAnswers[randomIndex];
                
                if (!distractors.includes(distractor) && distractor !== correctAnswer) {
                    distractors.push(distractor);
                }
            }
            
            // åˆå¹¶ç­”æ¡ˆå’Œå¹²æ‰°é¡¹ï¼Œå¹¶æ‰“ä¹±é¡ºåº
            const options = [correctAnswer, ...distractors]
                .sort(() => Math.random() - 0.5);
            
            // ä¿å­˜å½“å‰é—®é¢˜çŠ¶æ€
            gameState.currentQuestion = {
                text: questionText,
                correctAnswer: correctAnswer,
                options: options,
                isChineseToEnglish: isChineseToEnglish
            };
            
            // æ›´æ–°UI
            elements.questionText.textContent = isChineseToEnglish ? `${questionText} â†’ ?` : `${questionText} â†’ ?`;
            
            // æ›´æ–°é€‰é¡¹
            elements.options.forEach((option, index) => {
                option.textContent = options[index];
                option.classList.remove('correct', 'wrong');
            });
        }
        
        // å¼€å§‹å€’è®¡æ—¶
        function startCountdown() {
            // æ¸…é™¤ç°æœ‰å®šæ—¶å™¨
            if (gameState.timer) {
                clearInterval(gameState.timer);
            }
            
            let timeLeft = gameState.countdown;
            elements.gameCountdown.textContent = timeLeft;
            
            // å¯åŠ¨å®šæ—¶å™¨
            gameState.timer = setInterval(() => {
                timeLeft--;
                elements.gameCountdown.textContent = timeLeft;
                
                // æœ€å10ç§’æ·»åŠ è­¦å‘Šæ•ˆæœ
                if (timeLeft <= 10) {
                    elements.gameCountdown.classList.add('warning');
                }
                
                // æ—¶é—´åˆ°ï¼Œæ¸¸æˆç»“æŸ
                if (timeLeft <= 0) {
                    clearInterval(gameState.timer);
                    endGame();
                }
            }, 1000);
        }
        
        // å¤„ç†é€‰é¡¹é€‰æ‹©
        function handleOptionSelect(event) {
            if (!gameState.currentQuestion || !gameState.isPlaying) return;
            
            const selectedIndex = parseInt(event.currentTarget.dataset.index);
            const selectedAnswer = gameState.currentQuestion.options[selectedIndex];
            const isCorrect = selectedAnswer === gameState.currentQuestion.correctAnswer;
            
            // ç¦ç”¨æ‰€æœ‰é€‰é¡¹
            elements.options.forEach(option => {
                option.style.pointerEvents = 'none';
            });
            
            // æ ‡è®°æ­£ç¡®/é”™è¯¯é€‰é¡¹
            event.currentTarget.classList.add(isCorrect ? 'correct' : 'wrong');
            
            // æ›´æ–°åˆ†æ•°
            gameState.score += isCorrect ? 1 : -1;
            elements.gameScore.textContent = `å¾—åˆ†: ${gameState.score}`;
            
            // æ’­æ”¾éŸ³æ•ˆ
            playSound(isCorrect ? 'correct' : 'wrong');
            
            if (isCorrect) {
                // æ­£ç¡®ï¼Œå»¶è¿Ÿåæ˜¾ç¤ºä¸‹ä¸€é¢˜
                setTimeout(() => {
                    // å¯ç”¨é€‰é¡¹
                    elements.options.forEach(option => {
                        option.style.pointerEvents = 'auto';
                    });
                    generateQuestion();
                }, 500);
            } else {
                // é”™è¯¯ï¼Œæ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆï¼Œä½¿ç”¨è®¾ç½®ä¸­çš„æç¤ºæ—¶é—´
                elements.correctAnswerDisplay.textContent = `æ­£ç¡®ç­”æ¡ˆ: ${gameState.currentQuestion.correctAnswer}`;
                elements.correctAnswerDisplay.classList.add('active');
                
                // åŠ¨æ€è®¾ç½®åŠ¨ç”»æ—¶é—´ï¼Œç¡®ä¿ä¸æç¤ºæ—¶é—´ä¸€è‡´
                elements.correctAnswerDisplay.style.animationDuration = `${gameState.hintTime}s`;
                
                setTimeout(() => {
                    elements.correctAnswerDisplay.classList.remove('active');
                    // å¯ç”¨é€‰é¡¹
                    elements.options.forEach(option => {
                        option.style.pointerEvents = 'auto';
                    });
                    generateQuestion();
                }, gameState.hintTime * 1000); // ä½¿ç”¨è®¾ç½®ä¸­çš„æç¤ºæ—¶é—´
            }
        }
        
        // åˆ›å»ºç¤¼èŠ±ç‰¹æ•ˆ
        function createConfetti() {
            const colors = ['#FF6B6B', '#4ECDC4', '#FFD166', '#06D6A0', '#118AB2', '#EF476F'];
            const container = elements.gameOverPopup.querySelector('.popup-content');
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.top = Math.random() * 100 + '%';
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                confetti.style.opacity = '1';
                container.appendChild(confetti);
                
                // åŠ¨ç”»
                setTimeout(() => {
                    confetti.style.transition = 'all 1s';
                    confetti.style.transform = `translate(${Math.random() * 200 - 100}px, ${Math.random() * 200 - 100}px) rotate(${Math.random() * 360}deg)`;
                    confetti.style.opacity = '0';
                }, 100);
                
                // ç§»é™¤å…ƒç´ 
                setTimeout(() => {
                    if (confetti.parentNode) {
                        confetti.parentNode.removeChild(confetti);
                    }
                }, 1100);
            }
        }
        
        // ç»“æŸæ¸¸æˆ
        function endGame() {
            gameState.isPlaying = false;
            
            // æ’­æ”¾ç»“æŸéŸ³æ•ˆ
            playSound('end');
            
            // æ˜¾ç¤ºæœ€ç»ˆå¾—åˆ†å’Œæ¶ˆæ¯
            elements.finalScore.textContent = gameState.score;
            
            if (gameState.score > 0) {
                elements.scoreMessage.textContent = `æ­å–œä½ è·å¾—${gameState.score}åˆ†ï¼`;
                // æ·»åŠ ç¤¼èŠ±ç‰¹æ•ˆ
                createConfetti();
            } else {
                elements.scoreMessage.textContent = "è¯·å†æ¥å†å‰";
                // æ·»åŠ é¼“åŠ±ç‰¹æ•ˆ
                const encouragement = document.createElement('div');
                encouragement.className = 'encouragement';
                encouragement.textContent = 'ğŸ’ª';
                elements.gameOverPopup.querySelector('.popup-content').insertBefore(encouragement, elements.scoreMessage);
                
                // ç§»é™¤é¼“åŠ±ç‰¹æ•ˆ
                setTimeout(() => {
                    if (encouragement.parentNode) {
                        encouragement.parentNode.removeChild(encouragement);
                    }
                }, 3000);
            }
            
            elements.gameOverPopup.classList.add('active');
        }
        
        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            // å…³é—­æ¸¸æˆç»“æŸå¼¹çª—
            elements.gameOverPopup.classList.remove('active');
            
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState.score = 0;
            gameState.isPlaying = true;
            gameState.usedWordIndices = []; // é‡ç½®å·²ä½¿ç”¨å•è¯è®°å½•
            
            // æ›´æ–°UI
            elements.gameScore.textContent = `å¾—åˆ†: ${gameState.score}`;
            elements.gameCountdown.textContent = gameState.countdown;
            elements.gameCountdown.classList.remove('warning');
            
            // é‡ç½®é€‰é¡¹çŠ¶æ€ï¼ˆç¡®ä¿å¯ä»¥ç‚¹å‡»ï¼‰
            elements.options.forEach(option => {
                option.style.pointerEvents = 'auto';
                option.classList.remove('correct', 'wrong');
            });
            
            // éšè—æ­£ç¡®ç­”æ¡ˆæ˜¾ç¤º
            elements.correctAnswerDisplay.classList.remove('active');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            elements.gameLoading.classList.add('active');
            
            // ç”Ÿæˆç¬¬ä¸€é¢˜å¹¶å¼€å§‹å€’è®¡æ—¶
            setTimeout(() => {
                generateQuestion();
                elements.gameLoading.classList.remove('active');
                startCountdown();
            }, 1000);
        }
        
        // è¿”å›é¦–é¡µ
        function returnToHome() {
            // åœæ­¢è®¡æ—¶å™¨
            if (gameState.timer) {
                clearInterval(gameState.timer);
                gameState.timer = null;
            }
            
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState.score = 0;
            gameState.isPlaying = false;
            gameState.usedWordIndices = []; // é‡ç½®å·²ä½¿ç”¨å•è¯è®°å½•
            
            // éšè—æ¸¸æˆç»“æŸå¼¹çª—
            elements.gameOverPopup.classList.remove('active');
            
            // åˆ‡æ¢åˆ°é¦–é¡µ
            elements.gamePage.classList.remove('active');
            elements.homePage.classList.add('active');
            
            // é‡ç½®æ¸¸æˆé¡µé¢
            elements.gameCountdown.classList.remove('warning');
            elements.correctAnswerDisplay.classList.remove('active');
        }
        
        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>